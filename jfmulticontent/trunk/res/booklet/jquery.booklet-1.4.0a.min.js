/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2012 W. Grauvogel (http://builtbywill.com/)
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version : 1.4.0a
 *
 * Originally based on the work of:
 *	1) Charles Mangin (http://clickheredammit.com/pageflip/)
 */
;(function(a){function b(b,c){var d=b,e=c,f=false,g=false,h=false,i=false,j=false,k=false,l={empty:'<div class="b-page-empty" title=""></div>',blank:'<div class="b-page-blank" title=""></div>',sF:'<div class="b-shadow-f"></div>',sB:'<div class="b-shadow-b"></div>'},m={leftToRight:"LTR",rightToLeft:"RTL"},n={},o={},p,q,r,s=new Array,t="",u="/page/",v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb={create:"bookletcreate",start:"bookletstart",change:"bookletchange",add:"bookletadd",remove:"bookletremove"},Fb,Gb=function(a,b,c){var d="",e="",f;if(a.attr("rel")){d=a.attr("rel")}if(a.attr("title")){e=a.attr("title")}if(a.hasClass("b-page-empty")){a.wrap('<div class="b-page"><div class="b-wrap"></div></div>')}else if(c.closed&&c.covers&&(b==1||b==c.pageTotal-2)){a.wrap('<div class="b-page"><div class="b-wrap b-page-cover"></div></div>')}else if(b%2!=0){a.wrap('<div class="b-page"><div class="b-wrap b-wrap-right"></div></div>')}else{a.wrap('<div class="b-page"><div class="b-wrap b-wrap-left"></div></div>')}f=a.parents(".b-page").addClass("b-page-"+b);if(c.pageNumbers&&!a.hasClass("b-page-empty")&&(!c.closed||c.closed&&!c.covers||c.closed&&c.covers&&b!=1&&b!=c.pageTotal-2)){if(c.direction==m.leftToRight){C++}a.parent().append('<div class="b-counter">'+C+"</div>");if(c.direction==m.rightToLeft){C--}}return{index:b,contentNode:a[0],pageNode:f[0],chapter:d,title:e}},Hb=function(){d.find(".b-load").children().unwrap();d.addClass("booklet");d.data("booklet",this);B=d.children().length;e.currentIndex=0;Lb();Qb();Mb();Tb();Ub();f=true;k=false;Fb={options:jQuery.extend({},e),index:e.currentIndex,pages:[s[e.currentIndex].contentNode,s[e.currentIndex+1].contentNode]};if(e.create){d.unbind(Eb.create+".booklet").bind(Eb.create+".booklet",e.create)}d.trigger(Eb.create,Fb)},Ib=function(){k=false;Qb();Vb()},Jb=function(){$b()},Kb=function(){$b();Pb();d.removeClass("booklet");d.removeData("booklet");f=false},Lb=function(){s=new Array;if(d.children().length%2!=0){if(e.closed&&e.covers){d.children().last().before(l.blank)}else{d.children().last().after(l.blank)}}if(e.closed){a(l.empty).attr({title:e.closedFrontTitle||"",rel:e.closedFrontChapter||""}).prependTo(d);d.children().last().attr({title:e.closedBackTitle||"",rel:e.closedBackChapter||""});d.append(l.empty)}e.pageTotal=d.children().length;C=0;if(e.direction==m.rightToLeft){C=e.pageTotal;if(e.closed){C-=2}if(e.covers){C-=2}a(d.children().get().reverse()).each(function(){a(this).appendTo(d)})}if(!f){if(e.direction==m.leftToRight){e.currentIndex=0}else if(e.direction==m.rightToLeft){e.currentIndex=e.pageTotal-2}if(!isNaN(e.startingPage)&&e.startingPage<=e.pageTotal&&e.startingPage>0){if(e.startingPage%2!=0){e.startingPage--}e.currentIndex=e.startingPage}}d.children().each(function(b){var c=new Gb(a(this),b,e);s.push(c)})},Mb=function(){Nb();Ob();Vb()},Nb=function(){d.find(".b-page").removeClass("b-pN b-p0 b-p1 b-p2 b-p3 b-p4").hide();if(e.currentIndex-2>=0){d.find(".b-page-"+(e.currentIndex-2)).addClass("b-pN").show();d.find(".b-page-"+(e.currentIndex-1)).addClass("b-p0").show()}d.find(".b-page-"+e.currentIndex).addClass("b-p1").show();d.find(".b-page-"+(e.currentIndex+1)).addClass("b-p2").show();if(e.currentIndex+3<=e.pageTotal){d.find(".b-page-"+(e.currentIndex+2)).addClass("b-p3").show();d.find(".b-page-"+(e.currentIndex+3)).addClass("b-p4").show()}D=d.find(".b-pN");E=d.find(".b-p0");F=d.find(".b-p1");G=d.find(".b-p2");H=d.find(".b-p3");I=d.find(".b-p4");J=d.find(".b-pN .b-wrap");K=d.find(".b-p0 .b-wrap");L=d.find(".b-p1 .b-wrap");M=d.find(".b-p2 .b-wrap");N=d.find(".b-p3 .b-wrap");O=d.find(".b-p4 .b-wrap");P=d.find(".b-wrap");if(e.shadows){d.find(".b-shadow-f, .b-shadow-b").remove();Q=a(l.sF).css(n.sF).appendTo(H);R=a(l.sB).appendTo(E).css(n.sB)}},Ob=function(){d.find(".b-shadow-f, .b-shadow-b, .b-p0, .b-p3").css({filter:"",zoom:""});d.find(".b-page").removeAttr("style");P.removeAttr("style");P.css(n.wrap);K.css(n.p0wrap);F.css(n.p1);G.css(n.p2);if(e.closed&&e.autoCenter&&e.currentIndex>=e.pageTotal-2){G.hide()}D.css(n.pN);E.css(n.p0);H.stop().css(n.p3);I.css(n.p4);if(e.closed&&e.autoCenter&&e.currentIndex==0){D.css({left:0});F.css({left:Ab});G.css({left:0});H.css({left:zb});I.css({left:0})}if(e.closed&&e.autoCenter&&(e.currentIndex==0||e.currentIndex>=e.pageTotal-2)){if(e.overlays){V.width("100%")}d.width(zb)}else{if(e.overlays){V.width("50%")}d.width(e.width)}d.find(".b-page").css({filter:"",zoom:""})},Pb=function(){d.find(".b-wrap").unwrap();d.find(".b-wrap").children().unwrap();d.find(".b-counter, .b-page-blank, .b-page-empty, .b-shadow-f, .b-shadow-b").remove();if(e.direction==m.rightToLeft){a(d.children().get().reverse()).each(function(){a(this).appendTo(d)})}},Qb=function(b){var c=false;if(b!=null&&typeof b!="undefined"){Pb();$b();k=false;e=a.extend({},e,b);c=true;Lb()}if(!e.width){e.width=d.width()}else if(typeof e.width=="string"&&e.width.indexOf("px")!=-1){e.width=e.width.replace("px","")}else if(typeof e.width=="string"&&e.width.indexOf("%")!=-1){vb=true;wb=e.width;e.width=e.width.replace("%","")/100*parseFloat(d.parent().css("width"))}if(!e.height){e.height=d.height()}else if(typeof e.height=="string"&&e.height.indexOf("px")!=-1){e.height=e.height.replace("px","")}else if(typeof e.height=="string"&&e.height.indexOf("%")!=-1){xb=true;yb=e.height;e.height=e.height.replace("%","")/100*parseFloat(d.parent().css("height"))}d.width(e.width);d.height(e.height);zb=e.width/2;Ab="-"+zb+"px";Bb=zb/2;Cb=e.height;Db=e.speed/2;if(e.closed&&e.autoCenter){if(e.currentIndex==0){d.width(zb)}else if(e.currentIndex>=e.pageTotal-2){d.width(zb)}}if(e.shadows){e.shadowTopFwdWidth="-"+e.shadowTopFwdWidth+"px";e.shadowTopBackWidth="-"+e.shadowTopBackWidth+"px"}e.pageTotal=d.children(".b-page").length;if(e.name){document.title=e.name}else{e.name=document.title}Rb();if(f){Mb()}if(e.menu&&a(e.menu).length>0){hb=a(e.menu);if(!hb.hasClass("b-menu")){hb.addClass("b-menu")}if(e.pageSelector&&hb.find(".b-selector-page").length==0){kb=a('<div class="b-selector b-selector-page"><span class="b-current">'+(e.currentIndex+1)+" - "+(e.currentIndex+2)+"</span></div>").appendTo(hb);lb=a("<ul></ul>").appendTo(kb).empty().css("height","auto");for(w=0;w<e.pageTotal;w+=2){x=w;mb=x+1+"-"+(x+2);if(e.closed){x--;if(w==0){mb="1"}else if(w==e.pageTotal-2){mb=e.pageTotal-2}else{mb=x+1+"-"+(x+2)}if(e.covers){x--;if(w==0){mb=""}else if(w==e.pageTotal-2){mb=""}else{mb=x+1+"-"+(x+2)}}}if(w==0){kb.find(".b-current").text(mb)}nb=s[w].title;if(nb==""){nb=s[w+1].title}if(e.direction==m.rightToLeft){nb=s[Math.abs(w-e.pageTotal)-1].title;if(nb==""){nb=s[Math.abs(w-e.pageTotal)-2].title}}ob=a('<li><a href="#'+u+(w+1)+'" id="selector-page-'+w+'"><span class="b-text">'+nb+'</span><span class="b-num">'+mb+"</span></a></li>").appendTo(lb);if(!e.hash){ob.find("a").bind("click.booklet",function(){if(e.direction==m.rightToLeft){kb.find(".b-current").text(a(this).find(".b-num").text());ec(Math.abs(parseInt(a(this).attr("id").replace("selector-page-",""))-e.pageTotal)-2)}else{ec(parseInt(a(this).attr("id").replace("selector-page-","")))}return false})}}pb=lb.height();lb.css({height:0,"padding-bottom":0});kb.bind("mouseenter.booklet",function(){lb.stop().animate({height:pb,paddingBottom:10},500)}).bind("mouseleave.booklet",function(){lb.stop().animate({height:0,paddingBottom:0},500)})}else if(!e.pageSelector){hb.find(".b-selector-page").remove();kb=lb=mb=nb=ob=pb=null}if(e.chapterSelector&&hb.find(".b-selector-chapter").length==0){qb=s[e.currentIndex].chapter;if(qb==""){qb=s[e.currentIndex+1].chapter}rb=a('<div class="b-selector b-selector-chapter"><span class="b-current">'+qb+"</span></div>").appendTo(hb);sb=a("<ul></ul>").appendTo(rb).empty().css("height","auto");for(w=0;w<e.pageTotal;w+=1){if(s[w].chapter!=""&&typeof s[w].chapter!="undefined"){if(e.direction==m.rightToLeft){x=w;if(x%2!=0){x--}rb.find(".b-current").text(s[w].chapter);tb=a('<li><a href="#'+u+(x+1)+'" id="selector-page-'+x+'"><span class="b-text">'+s[w].chapter+"</span></a></li>").prependTo(sb)}else{tb=a('<li><a href="#'+u+(w+1)+'" id="selector-page-'+w+'"><span class="b-text">'+s[w].chapter+"</span></a></li>").appendTo(sb)}if(!e.hash){tb.find("a").bind("click.booklet",function(){if(e.direction==m.rightToLeft){rb.find(".b-current").text(a(this).find(".b-text").text());ec(Math.abs(parseInt(a(this).attr("id").replace("selector-page-",""))-e.pageTotal)-2)}else{ec(parseInt(a(this).attr("id").replace("selector-page-","")))}return false})}}}ub=sb.height();sb.css({height:0,"padding-bottom":0});rb.bind("mouseenter.booklet",function(){sb.stop().animate({height:ub,paddingBottom:10},500)}).bind("mouseleave.booklet",function(){sb.stop().animate({height:0,paddingBottom:0},500)})}else if(!e.chapterSelector){hb.find(".b-selector-chapter").remove();qb=rb=sb=tb=ub=null}}else{hb=null;if(e.menu){a(e.menu).removeClass("b-menu")}d.find(".b-selector").remove()}U=d.find(".b-controls");if(U.length==0){U=a('<div class="b-controls"></div>').appendTo(d)}if(e.manual&&a.ui){e.overlays=false}if(db){db.unbind("click.booklet")}if(e.next&&a(e.next).length>0){db=a(e.next);db.bind("click.booklet",function(a){a.preventDefault();cc()})}else{db=null}if(eb){eb.unbind("click.booklet")}if(e.prev&&a(e.prev).length>0){eb=a(e.prev);eb.bind("click.booklet",function(a){a.preventDefault();dc()})}else{eb=null}V=d.find(".b-overlay");if(e.overlays&&V.length==0){X=a('<div class="b-overlay b-overlay-prev b-prev" title="'+e.previousControlTitle+'"></div>').appendTo(U);W=a('<div class="b-overlay b-overlay-next b-next" title="'+e.nextControlTitle+'"></div>').appendTo(U);V=d.find(".b-overlay");if(a.browser.msie){V.css({background:"#fff",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0) !important"})}}else if(!e.overlays){V.remove();V=null}Y=d.find(".b-tab");if(e.tabs&&Y.length==0){_=a('<div class="b-tab b-tab-prev b-prev" title="'+e.previousControlTitle+'">'+e.previousControlText+"</div>").appendTo(U);Z=a('<div class="b-tab b-tab-next b-next" title="'+e.nextControlTitle+'">'+e.nextControlText+"</div>").appendTo(U);Y=d.find(".b-tab")}else if(!e.tabs){d.css({marginTop:0});Y.remove();Y=null}if(e.tabs&&Y.length>0){if(e.tabWidth){Y.width(e.tabWidth)}if(e.tabHeight){Y.height(e.tabHeight)}Y.css({top:"-"+Z.outerHeight()+"px"});d.css({marginTop:Z.outerHeight()});if(e.direction==m.rightToLeft){Z.html(e.previousControlText).attr("title",e.previousControlTitle);_.html(e.nextControlText).attr("title",e.nextControlTitle)}}ab=d.find(".b-arrow");if(e.arrows&&ab.length==0){cb=a('<div class="b-arrow b-arrow-prev b-prev" title="'+e.previousControlTitle+'"><div>'+e.previousControlText+"</div></div>").appendTo(U);bb=a('<div class="b-arrow b-arrow-next b-next" title="'+e.nextControlTitle+'"><div>'+e.nextControlText+"</div></div>").appendTo(U);ab=d.find(".b-arrow");if(e.direction==m.rightToLeft){bb.html("<div>"+e.previousControlText+"</div>").attr("title",e.previousControlTitle);cb.html("<div>"+e.nextControlText+"</div>").attr("title",e.nextControlTitle)}}else if(!e.arrows){ab.remove();ab=null}fb=U.find(".b-next");gb=U.find(".b-prev");fb.unbind(".booklet");gb.unbind(".booklet");fb.bind("click.booklet",function(a){a.preventDefault();cc()});gb.bind("click.booklet",function(a){a.preventDefault();dc()});if(e.overlays&&e.hovers){fb.bind("mouseover.booklet",function(){fc(true)}).bind("mouseout.booklet",function(){gc(true)});gb.bind("mouseover.booklet",function(){fc(false)}).bind("mouseout.booklet",function(){gc(false)})}if(e.arrows){if(e.arrowsHide){if(a.support.opacity){fb.bind("hover.booklet",function(){bb.find("div").stop().fadeTo("fast",1)},function(){bb.find("div").stop().fadeTo("fast",0)});gb.bind("hover.booklet",function(){cb.find("div").stop().fadeTo("fast",1)},function(){cb.find("div").stop().fadeTo("fast",0)})}else{fb.bind("hover.booklet",function(){bb.find("div").show()},function(){bb.find("div").hide()});gb.bind("hover.booklet",function(){cb.find("div").show()},function(){cb.find("div").hide()})}}else{bb.find("div").show();cb.find("div").show()}}a(document).bind("keyup.booklet",function(a){if(a.keyCode==37&&e.keyboard&&!k){dc()}else if(a.keyCode==39&&e.keyboard&&!k){cc()}});clearInterval(y);y=null;if(e.hash){Wb();clearInterval(y);y=setInterval(function(){Xb()},250)}a(window).bind("resize.booklet",function(){if((vb||xb)&&!k){Sb()}});if(e.auto&&e.delay){clearInterval(z);z=setInterval(function(){if(e.direction==m.leftToRight){cc()}else{dc()}},e.delay);h=true;if(e.pause&&a(e.pause).length>0){ib=a(e.pause);ib.unbind("click.booklet").bind("click.booklet",function(a){a.preventDefault();if(h){clearInterval(z);h=false}})}if(e.play&&a(e.play).length>0){jb=a(e.play);jb.unbind("click.booklet").bind("click.booklet",function(a){a.preventDefault();if(!h){clearInterval(z);z=setInterval(function(){if(e.direction==m.leftToRight){cc()}else{dc()}},e.delay);h=true}})}}else{clearInterval(z);z=null;if(e.pause&&a(e.pause).length>0){a(e.pause).unbind("click.booklet")}ib=null;if(e.play&&a(e.play).length>0){a(e.play).unbind("click.booklet")}jb=null;h=false}if(c){Mb();Tb();Ub()}},Rb=function(){n={wrap:{left:0,width:zb-e.pagePadding*2-e.pageBorder*2,height:Cb-e.pagePadding*2-e.pageBorder*2,padding:e.pagePadding},p0wrap:{right:0,left:"auto"},p1:{left:0,width:zb,height:Cb},p2:{left:zb,width:zb,opacity:1,height:Cb},pN:{left:0,width:zb,height:Cb},p0:{left:0,width:0,height:Cb},p3:{left:zb*2,width:0,height:Cb,paddingLeft:0},p4:{left:zb,width:zb,height:Cb},sF:{right:0,width:zb,height:Cb},sB:{left:0,width:zb,height:Cb}};p=10;q=e.hoverWidth+p;r=e.hoverWidth/2+p;o={hover:{speed:e.hoverSpeed,size:e.hoverWidth,p2:{width:zb-r},p3:{left:e.width-q,width:r},p3closed:{left:zb-e.hoverWidth,width:r},p3wrap:{left:p},p2end:{width:zb},p2closedEnd:{width:zb,left:0},p3end:{left:e.width,width:0},p3closedEnd:{left:zb,width:0},p3wrapEnd:{left:10},p1:{left:r,width:zb-r},p1wrap:{left:"-"+r+"px"},p0:{left:r,width:r},p0wrap:{right:p},p1end:{left:0,width:zb},p1wrapEnd:{left:0},p0end:{left:0,width:0},p0wrapEnd:{right:0}},p2:{width:0},p2closed:{width:0,left:zb},p4closed:{left:zb},p3in:{left:Bb,width:Bb,paddingLeft:e.shadowBtmWidth},p3inDrag:{left:zb/4,width:zb*.75,paddingLeft:e.shadowBtmWidth},p3out:{left:0,width:zb,paddingLeft:0},p3wrapIn:{left:e.shadowBtmWidth},p3wrapOut:{left:0},p1:{left:zb,width:0},p1wrap:{left:Ab},p0:{left:zb,width:zb},p0in:{left:Bb,width:Bb},p0out:{left:zb,width:zb},p0outClosed:{left:0,width:zb},p2back:{left:0},p0wrapDrag:{right:0},p0wrapIn:{right:e.shadowBtmWidth},p0wrapOut:{right:0}}},Sb=function(){if(vb){e.width=wb.replace("%","")/100*parseFloat(d.parent().css("width"));d.width(e.width);zb=e.width/2;Ab="-"+zb+"px";Bb=zb/2}if(xb){e.height=yb.replace("%","")/100*parseFloat(d.parent().css("height"));d.height(e.height);Cb=e.height}Rb();Ob()},Tb=function(){if(e.overlays||e.tabs||e.arrows){if(a.support.opacity){if(e.currentIndex>=2&&e.currentIndex!=0){gb.fadeIn("fast").css("cursor",e.cursor)}else{gb.fadeOut("fast").css("cursor","default")}if(e.currentIndex<e.pageTotal-2){fb.fadeIn("fast").css("cursor",e.cursor)}else{fb.fadeOut("fast").css("cursor","default")}}else{if(e.currentIndex>=2&&e.currentIndex!=0){gb.show().css("cursor",e.cursor)}else{gb.hide().css("cursor","default")}if(e.currentIndex<e.pageTotal-2){fb.show().css("cursor",e.cursor)}else{fb.hide().css("cursor","default")}}}},Ub=function(){if(e.pageSelector){var b="";if(e.direction==m.rightToLeft){b=Math.abs(e.currentIndex-e.pageTotal)-1+" - "+Math.abs(e.currentIndex-e.pageTotal);if(e.closed){if(e.currentIndex==e.pageTotal-2){b="1"}else if(e.currentIndex==0){b=e.pageTotal-2}else{b=Math.abs(e.currentIndex-e.pageTotal)-2+" - "+(Math.abs(e.currentIndex-e.pageTotal)-1)}if(e.covers){if(e.currentIndex==e.pageTotal-2){b=""}else if(e.currentIndex==0){b=""}else{b=Math.abs(e.currentIndex-e.pageTotal)-3+" - "+(Math.abs(e.currentIndex-e.pageTotal)-2)}}}}else{b=e.currentIndex+1+" - "+(e.currentIndex+2);if(e.closed){if(e.currentIndex==0){b="1"}else if(e.currentIndex==e.pageTotal-2){b=e.pageTotal-2}else{b=e.currentIndex+"-"+(e.currentIndex+1)}if(e.covers){if(e.currentIndex==0){b=""}else if(e.currentIndex==e.pageTotal-2){b=""}else{b=e.currentIndex-1+"-"+e.currentIndex}}}}a(e.menu+" .b-selector-page .b-current").text(b)}if(e.chapterSelector){if(s[e.currentIndex].chapter!=""){a(e.menu+" .b-selector-chapter .b-current").text(s[e.currentIndex].chapter)}else if(s[e.currentIndex+1].chapter!=""){a(e.menu+" .b-selector-chapter .b-current").text(s[e.currentIndex+1].chapter)}if(e.direction==m.rightToLeft&&s[e.currentIndex+1].chapter!=""){a(e.menu+" .b-selector-chapter .b-current").text(s[e.currentIndex+1].chapter)}else if(s[e.currentIndex]!=""){a(e.menu+" .b-selector-chapter .b-current").text(s[e.currentIndex].chapter)}}},Vb=function(){var b,c,f,g,h,k,l,m,s,t,u;i=j=S=T=false;if(d.find(".b-page").data("draggable")){d.find(".b-page").draggable("destroy").removeClass("b-grab b-grabbing")}if(e.manual&&a.ui){H.draggable({axis:"x",containment:[d.offset().left,0,G.offset().left+zb-q,Cb],drag:function(i,j){S=true;H.removeClass("b-grab").addClass("b-grabbing");b=j.originalPosition.left;c=j.position.left;f=b-c;g=f/b;h=g<.5?g:1-g;k=h*e.shadowBtmWidth*2+p;k=f/b>=.5?k-=p:k;if(e.shadows){Q.css({right:"-"+e.shadowTopFwdWidth*h*2+"px"});if(a.support.opacity){Q.css({opacity:h*2})}else{Q.css({right:"auto",left:.1*H.width()})}}l=r+f/2;l=l>zb?zb:l;m=zb-l;if(e.closed&&e.autoCenter){if(e.currentIndex==0){s=.5+.5*g;l=r+r*g+f;l=l>zb?zb:l;m=zb-l;G.css({left:zb*g});I.css({left:zb*g});d.width(e.width*s)}else if(e.currentIndex==e.pageTotal-4){s=1-g+.5*g;m=zb-l;I.hide();d.width(e.width*s)}else{d.width(e.width)}}H.width(l);N.css({left:k});G.width(m)},stop:function(b,c){gc(false);if(g>e.hoverThreshold){if(e.shadows&&!a.support.opacity){Q.css({left:"auto",opacity:0})}cc();H.removeClass("b-grab b-grabbing")}else{S=false;H.removeClass("b-grabbing").addClass("b-grab");Q.animate({left:"auto",opacity:0},o.hover.speed,e.easing).css(n.sF);if(e.closed&&e.autoCenter){if(e.currentIndex==0){G.animate({left:0},o.hover.speed,e.easing);I.animate({left:0},o.hover.speed,e.easing);d.animate({width:e.width*.5},o.hover.speed,e.easing)}else{d.animate({width:e.width},o.hover.speed,e.easing)}}}}});E.draggable({axis:"x",containment:[d.offset().left+r,0,d.offset().left+e.width,Cb],drag:function(i,j){T=true;E.removeClass("b-grab").addClass("b-grabbing");b=j.originalPosition.left;c=j.position.left;f=c-b;g=f/(e.width-b);if(e.closed&&e.autoCenter&&e.currentIndex==2){g=f/(zb-b)}if(g>1){g=1}h=g<.5?g:1-g;k=h*e.shadowBtmWidth*2+p;k=f/b>=.5?k-=p:k;if(e.shadows){if(a.support.opacity){R.css({opacity:h*2})}else{R.css({left:e.shadowTopBackWidth*h*2})}}l=g*(zb-r)+r+k;t=l-k;u=-t;if(e.closed&&e.autoCenter){if(e.currentIndex==2){s=1-g+.5*g;t=(1-g)*t;u=-t-(e.width-e.width*s);D.hide();G.css({left:zb*(1-g)});I.css({left:zb*(1-g)});d.width(e.width*s)}else if(e.currentIndex==e.pageTotal-2){s=.5+.5*g;d.width(e.width*s)}else{d.width(e.width)}}j.position.left=t;E.css({width:l});K.css({right:k});F.css({left:t,width:zb-t});L.css({left:u})},stop:function(a,b){gc(true);if(g>e.hoverThreshold){dc();E.removeClass("b-grab b-grabbing")}else{R.animate({opacity:0},o.hover.speed,e.easing).css(n.sB);T=false;E.removeClass("b-grabbing").addClass("b-grab");if(e.closed&&e.autoCenter){if(e.currentIndex==2){G.animate({left:zb},o.hover.speed*2,e.easing);I.animate({left:zb},o.hover.speed*2,e.easing);d.animate({width:e.width},o.hover.speed*2,e.easing)}else if(e.currentIndex==e.pageTotal-2){d.animate({width:e.width*.5},o.hover.speed,e.easing)}}}}});d.find(".b-page").unbind("click.booklet");if(e.hoverClick){d.find(".b-pN, .b-p0").bind("click.booklet",dc).css({cursor:"pointer"});d.find(".b-p3, .b-p4").bind("click.booklet",cc).css({cursor:"pointer"})}d.unbind("mousemove.booklet").bind("mousemove.booklet",function(a){f=a.pageX-d.offset().left;if(f<o.hover.size){fc(false)}else if(f>zb-o.hover.size&&e.currentIndex==0&&e.autoCenter&&e.closed){fc(true)}else if(f>o.hover.size&&f<=e.width-o.hover.size){gc(false);gc(true)}else if(f>e.width-o.hover.size){fc(true)}}).unbind("mouseleave.booklet").bind("mouseleave.booklet",function(){gc(false);gc(true)})}},Wb=function(){v=Yb();if(!isNaN(v)&&v<=e.pageTotal-1&&v>=0&&v!=""){if(v%2!=0){v--}e.currentIndex=v}else{Zb(e.currentIndex+1,e)}t=v},Xb=function(){v=Yb();if(!isNaN(v)&&v<=e.pageTotal-1&&v>=0){if(v!=e.currentIndex&&v.toString()!=t){if(v%2!=0){v--}document.title=e.name+e.hashTitleText+(v+1);if(!g){ec(v);t=v}}}},Yb=function(){var a,b;a=window.location.hash.split("/");if(a.length>1){b=parseInt(a[2])-1;if(e.direction==m.rightToLeft){b=Math.abs(b+1-e.pageTotal)}return b}else{return""}},Zb=function(a,b){if(b.hash){if(b.direction==m.rightToLeft){a=Math.abs(a-b.pageTotal)}window.location.hash=u+a}},$b=function(){if(e.menu){a(e.menu).removeClass("b-menu")}hb=null;if(db){db.unbind("click.booklet");db=null}if(eb){eb.unbind("click.booklet");eb=null}if(fb){fb.unbind(".booklet");fb=null}if(gb){gb.unbind(".booklet");gb=null}d.find(".b-selector, .b-controls").remove();k=true;clearInterval(y);y=null;clearInterval(z);z=null;if(e.pause&&a(e.pause).length>0){a(e.pause).unbind("click.booklet")}ib=null;if(e.play&&a(e.play).length>0){a(e.play).unbind("click.booklet")}jb=null;_b()},_b=function(){if(d.find(".b-page").data("draggable")){d.find(".b-page").draggable("destroy").removeClass("b-grab b-grabbing")}d.unbind(".booklet")},ac=function(a,b){if(a=="start"){a=0}else if(a=="end"){a=B}else if(typeof a=="number"){if(a<0||a>B){return}}else if(typeof a=="undefined"){return}if(typeof b=="undefined"||b==""){return}Pb();$b();if(e.closed&&e.covers&&a==B){d.children(":eq("+(a-1)+")").before(b)}else if(e.closed&&e.covers&&a==0){d.children(":eq("+a+")").after(b)}else if(a==B){d.children(":eq("+(a-1)+")").after(b)}else{d.children(":eq("+a+")").before(b)}B=d.children().length;Fb={options:jQuery.extend({},e),index:a,page:d.children(":eq("+a+")")[0]};if(e.add){d.unbind(Eb.add+".booklet").bind(Eb.add+".booklet",e.add)}d.trigger(Eb.add,Fb);k=false;Lb();Qb();Mb();Tb();Ub()},bc=function(a){if(a=="start"){a=0}else if(a=="end"){a=B}else if(typeof a=="number"){if(a<0||a>B){return}}else if(typeof a=="undefined"){return}if(d.children(".b-page").length==2&&d.find(".b-page-blank").length>0){return}Pb();$b();if(a>=e.currentIndex){if(a>0&&a%2!=0){e.currentIndex-=2}if(e.currentIndex<0){e.currentIndex=0}}var b;if(e.closed&&e.covers&&a==B){b=d.children(":eq("+(a-1)+")").remove()}else if(e.closed&&e.covers&&a==0){b=d.children(":eq("+a+")").remove()}else if(a==B){b=d.children(":eq("+(a-1)+")").remove()}else{b=d.children(":eq("+a+")").remove()}B=d.children().length;Fb={options:jQuery.extend({},e),index:a,page:b[0]};if(e.remove){d.unbind(Eb.remove+".booklet").bind(Eb.remove+".booklet",e.remove)}d.trigger(Eb.remove,Fb);b=null;k=false;Lb();Mb();Qb();Tb();Ub()},cc=function(){if(!g){if(h&&e.currentIndex+2>=e.pageTotal){ec(0)}else{ec(e.currentIndex+2)}}},dc=function(){if(!g){if(h&&e.currentIndex-2<0){ec(e.pageTotal-2)}else{ec(e.currentIndex-2)}}},ec=function(a){var b;if(a>e.currentIndex&&a<e.pageTotal&&a>=0&&!g){g=true;A=a-e.currentIndex;e.currentIndex=a;e.movingForward=true;Fb={options:jQuery.extend({},e),index:a,pages:[s[a].contentNode,s[a+1].contentNode]};if(e.start){d.unbind(Eb.start+".booklet").bind(Eb.start+".booklet",e.start)}d.trigger(Eb.start,Fb);Ub();if(a==e.pageTotal-2)Tb();Zb(e.currentIndex+1,e);b=S===true?e.speed*(H.width()/zb):Db;hc(A,true,Q,b);if(e.closed&&e.autoCenter&&a-A==0){G.stop().animate(o.p2closed,S===true?b:b*2,e.easing);I.stop().animate(o.p4closed,S===true?b:b*2,e.easing)}else{G.stop().animate(o.p2,b,S===true?e.easeOut:e.easeIn)}if(S){H.animate(o.p3out,b,e.easeOut);N.animate(o.p3wrapOut,b,e.easeOut,function(){ic()})}else{H.stop().animate(o.p3in,b,e.easeIn).animate(o.p3out,b,e.easeOut);N.animate(o.p3wrapIn,b,e.easeIn).animate(o.p3wrapOut,b,e.easeOut,function(){ic()})}}else if(a<e.currentIndex&&a<e.pageTotal&&a>=0&&!g){g=true;A=e.currentIndex-a;e.currentIndex=a;e.movingForward=false;Fb={options:jQuery.extend({},e),index:a,pages:[s[a].contentNode,s[a+1].contentNode]};if(e.start){d.unbind(Eb.start+".booklet").bind(Eb.start+".booklet",e.start)}d.trigger(Eb.start,Fb);Ub();if(a==0)Tb();Zb(e.currentIndex+1,e);b=T===true?e.speed*(E.width()/zb):Db;hc(A,false,R,b);if(T){F.animate(o.p1,b,e.easeOut);L.animate(o.p1wrap,b,e.easeOut);if(e.closed&&e.autoCenter&&e.currentIndex==0){E.animate(o.p0outClosed,b,e.easeOut);G.stop().animate(o.p2back,b,e.easeOut)}else{E.animate(o.p0,b,e.easeOut)}K.animate(o.p0wrapDrag,b,e.easeOut,function(){ic()})}else{F.animate(o.p1,b*2,e.easing);L.animate(o.p1wrap,b*2,e.easing);if(e.closed&&e.autoCenter&&e.currentIndex==0){E.animate(o.p0in,b,e.easeIn).animate(o.p0outClosed,b,e.easeOut);G.stop().animate(o.p2back,b*2,e.easing)}else{E.animate(o.p0in,b,e.easeIn).animate(o.p0out,b,e.easeOut)}K.animate(o.p0wrapIn,b,e.easeIn).animate(o.p0wrapOut,b,e.easeOut,function(){ic()})}}},fc=function(b){if(e.hovers&&e.overlays||e.manual){if(b){if(!g&&!i&&!j&&!S&&e.currentIndex+2<=e.pageTotal-2){G.stop().animate(o.hover.p2,o.hover.speed,e.easing);H.addClass("b-grab");if(e.closed&&e.autoCenter&&e.currentIndex==0){H.stop().animate(o.hover.p3closed,o.hover.speed,e.easing)}else{H.stop().animate(o.hover.p3,o.hover.speed,e.easing)}N.stop().animate(o.hover.p3wrap,o.hover.speed,e.easing);if(e.shadows&&!a.support.opacity){Q.css({right:"auto",left:"-40%"})}i=true}}else{if(!g&&!j&&!i&&!T&&e.currentIndex-2>=0){F.stop().animate(o.hover.p1,o.hover.speed,e.easing);E.addClass("b-grab");L.stop().animate(o.hover.p1wrap,o.hover.speed,e.easing);E.stop().animate(o.hover.p0,o.hover.speed,e.easing);K.stop().animate(o.hover.p0wrap,o.hover.speed,e.easing);if(e.shadows&&!a.support.opacity){R.css({left:-.38*zb})}j=true}}}},gc=function(b){if(e.hovers&&e.overlays||e.manual){if(b){if(!g&&i&&!S&&e.currentIndex+2<=e.pageTotal-2){if(e.closed&&e.autoCenter&&e.currentIndex==0){G.stop().animate(o.hover.p2closedEnd,o.hover.speed,e.easing);H.stop().animate(o.hover.p3closedEnd,o.hover.speed,e.easing)}else{G.stop().animate(o.hover.p2end,o.hover.speed,e.easing);H.stop().animate(o.hover.p3end,o.hover.speed,e.easing)}N.stop().animate(o.hover.p3wrapEnd,o.hover.speed,e.easing);if(e.shadows&&!a.support.opacity){Q.css({left:"auto"})}i=false}}else{if(!g&&j&&!T&&e.currentIndex-2>=0){F.stop().animate(o.hover.p1end,o.hover.speed,e.easing);L.stop().animate(o.hover.p1wrapEnd,o.hover.speed,e.easing);E.stop().animate(o.hover.p0end,o.hover.speed,e.easing);K.stop().animate(o.hover.p0wrapEnd,o.hover.speed,e.easing);j=false}}}},hc=function(b,c,f,g){if(c&&b>2){d.find(".b-p3, .b-p4").removeClass("b-p3 b-p4").hide();d.find(".b-page-"+e.currentIndex).addClass("b-p3").show().stop().css(n.p3);d.find(".b-page-"+(e.currentIndex+1)).addClass("b-p4").show().css(n.p4);d.find(".b-page-"+e.currentIndex+" .b-wrap").show().css(n.wrap);d.find(".b-page-"+(e.currentIndex+1)+" .b-wrap").show().css(n.wrap);H=d.find(".b-p3");I=d.find(".b-p4");N=d.find(".b-p3 .b-wrap");O=d.find(".b-p4 .b-wrap");if(e.closed&&e.autoCenter&&e.currentIndex-b==0){H.css({left:zb});I.css({left:0})}if(i){H.css({left:e.width-40,width:20,"padding-left":10})}if(e.shadows){d.find(".b-shadow-f").remove();Q=a(l.sF).css(n.sF).appendTo(H);f=Q}}else if(!c&&b>2){d.find(".b-pN, .b-p0").removeClass("b-pN b-p0").hide();d.find(".b-page-"+e.currentIndex).addClass("b-pN").show().css(n.pN);d.find(".b-page-"+(e.currentIndex+1)).addClass("b-p0").show().css(n.p0);d.find(".b-page-"+e.currentIndex+" .b-wrap").show().css(n.wrap);d.find(".b-page-"+(e.currentIndex+1)+" .b-wrap").show().css(n.wrap);D=d.find(".b-pN");E=d.find(".b-p0");J=d.find(".b-pN .b-wrap");K=d.find(".b-p0 .b-wrap");if(e.closed&&e.autoCenter){D.css({left:0})}K.css(n.p0wrap);if(j){E.css({left:10,width:40});K.css({right:10})}if(e.shadows){d.find(".b-shadow-b, .b-shadow-f").remove();R=a(l.sB).appendTo(E).css(n.sB);f=R}}if(e.closed){if(!c&&e.currentIndex==0){D.hide()}else if(!c){D.show()}if(c&&e.currentIndex>=e.pageTotal-2){I.hide()}else if(c){I.show()}}if(e.shadows){if(a.support.opacity){if(!S&&!T){f.animate({opacity:1},g,e.easeIn)}f.animate({opacity:0},g,e.easeOut)}else{if(c){f.animate({right:e.shadowTopFwdWidth},g*2,e.easeIn)}else{f.animate({left:e.shadowTopBackWidth},g*2,e.easeIn)}}}if(e.closed&&e.autoCenter){if(e.currentIndex==0){H.hide();I.hide();d.animate({width:zb},!S&&!T?g*2:g,e.easing)}else if(e.currentIndex>=e.pageTotal-2){E.hide();D.hide();d.animate({width:zb},g*2,e.easing)}else{d.animate({width:e.width},g*2,e.easing)}}},ic=function(){Mb();Ub();Tb();g=false;Fb={options:jQuery.extend({},e),index:e.currentIndex,pages:[s[e.currentIndex].contentNode,s[e.currentIndex+1].contentNode]};if(e.change){d.unbind(Eb.change+".booklet").bind(Eb.change+".booklet",e.change)}d.trigger(Eb.change,Fb)};return{init:Hb,enable:Ib,disable:Jb,destroy:Kb,next:cc,prev:dc,gotopage:function(a){if(typeof a==="string"){if(a=="start"){a=0}else if(a=="end"){a=B-1}}else if(typeof a==="number"){if(a<0||a>=B){return}}else if(typeof a==="undefined"){return}if(a%2!=0){a-=1}if(e.direction==m.rightToLeft){a=Math.abs(a-e.pageTotal)-2}ec(a)},add:ac,remove:bc,option:function(b,c){if(typeof b==="string"){if(e[b]){if(typeof c!=="undefined"){e[b]=c;Qb()}else{return e[b]}}else{a.error('Option "'+b+'" does not exist on jQuery.booklet.')}}else if(typeof b==="object"){Qb(b)}else if(typeof b==="undefined"||!b){return jQuery.extend({},e)}}}}a.fn.booklet=function(c,d,e){var f,g,h,i,j,k,l;if(typeof c==="string"){j=new Array;a(this).each(function(){f=a(this).data("booklet");if(f){g=c;h=new Array;if(d){h.push(d)}if(e){h.push(e)}if(f[g]){i=f[g].apply(f,h);if(typeof i!=="undefined"||i){j.push(f[g].apply(f,h))}}else{a.error('Method "'+g+'" does not exist on jQuery.booklet.')}}else{a.error('jQuery.booklet has not been initialized. Method "'+c+'" cannot be called.')}});if(j.length==1){return j[0]}else if(j.length>0){return j}else{return a(this)}}else if(typeof c==="number"){return a(this).each(function(){f=a(this).data("booklet");if(f){l=c;f.gotopage(l)}else{a.error("jQuery.booklet has not been initialized.")}})}else if(typeof g==="object"||!g){return a(this).each(function(){k=a.extend({},a.fn.booklet.defaults,c);f=a(this).data("booklet");if(f){f.destroy()}f=new b(a(this),k);f.init();return this})}};a.fn.booklet.defaults={name:null,width:600,height:400,speed:1e3,direction:"LTR",startingPage:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",closed:false,closedFrontTitle:"Beginning",closedFrontChapter:"Beginning of Book",closedBackTitle:"End",closedBackChapter:"End of Book",covers:false,autoCenter:false,pagePadding:10,pageNumbers:true,pageBorder:0,manual:true,hovers:true,hoverWidth:50,hoverSpeed:500,hoverThreshold:.25,hoverClick:true,overlays:false,tabs:false,tabWidth:60,tabHeight:20,nextControlText:"Next",previousControlText:"Previous",nextControlTitle:"Next Page",previousControlTitle:"Previous Page",arrows:false,arrowsHide:false,cursor:"pointer",hash:false,hashTitleText:" - Page ",keyboard:true,next:null,prev:null,auto:false,delay:5e3,pause:null,play:null,menu:null,pageSelector:false,chapterSelector:false,shadows:true,shadowTopFwdWidth:166,shadowTopBackWidth:166,shadowBtmWidth:50,create:null,start:null,change:null,add:null,remove:null}})(jQuery);